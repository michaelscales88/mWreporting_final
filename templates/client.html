<!-- client module page: client.html -->
{% extends 'base.html' %}


{% block control_area %}
    {{ super() }}
    <div class="row">
        <div class="col-lg-6">
            <h1 class="display-3">{{ title if title else 'Default_Data' }}</h1>
        </div>
        <div class="col-lg-6">
            <div class="form-row">
                <label for="client-select">Showing:</label>
                <p id="client-select">Active/Inactive/All Select Box</p>
            </div>
            <div class="form-row">
                <label for="client-select">Clients:</label>
                <p><select id="client-select" title="Clients" multiple="multiple" style="width: 100%"></select></p>
            </div>
        </div>
    </div>
    {% include "partials/client_modal.html" %}
    <div class="row">
        <div class="col-sm-4"data-toggle="tooltip" data-placement="bottom" title="Add/Reactivate client.">
            <button type="button" class="btn btn-primary button-class" data-toggle="modal" data-target="#clientModal"
                    style="width: 100%" value="Add">Add Client</button>
        </div>
        <div class="col-sm-4" data-toggle="tooltip" data-placement="bottom" title="Deactivate a client.">
            <button type="button" class="btn btn-primary button-class" data-toggle="modal" data-target="#clientModal"
                    style="width: 100%" value="Remove">Remove Client</button>
        </div>
        <div class="col-sm-4">
            <button type="button" class="btn btn-primary" id="refreshTableButton" style="width: 100%"
                data-toggle="tooltip" data-placement="bottom" title="Update the page based on the current selection.">
                Get Selection
            </button>
        </div>
    </div>
{% endblock control_area %}

{% block data_area %}
    {{ super() }}{% include "partials/data_grid.html" %}
{% endblock data_area %}

{% block scripts %}
    {{ super() }}
    <script type="text/javascript">
        $(document).ready(function () {
            // Client Grid Area configuration
            configClientPage();

            // Client Selector JS
            $.getScript("{{ url_for("static", filename="js/client-selector.js") }}", function () {
                updateSelectOptions();

                $("button#onClick").click(function() {
                    let method = $(".modal-body #hiddenValue").val();
                    $.ajax({
                        url: '/api/client',
                        method: (method === 'Add') ? 'PUT': 'DELETE',
                        data: $("form#clientForm").serialize(),
                        success: function (data, success) {
                            $("button#formReset").click();
                            if (success === 'success') {
                                $("button#refreshTableButton").click();
                                updateSelectOptions();
                                toastr.success("Client: " + method + " completed successfully!");
                            }
                        }
                    })
                });
            });

            // Clear the modal's form
            $("button#formReset").on("click", function () {
                document.getElementById("clientForm").reset();
            });

            // Configure the modal to be used for Add and Remove
            $(".button-class").click(function () {
                let action = $(this).val();
                $("#modal-title").text(action + " Client");
                $(".modal-body #hiddenValue").val(action);
            })
        });
    </script>
{% endblock scripts %}
